# source this script from a terminal in the repository's installer dir to rebuild the mac .pkg installer file
#  - runs pyinstaller to make 'postinstall script' executbale
#  - assembles host files, 'postinstall script' executable, and prerequisites
#  - runs pkgbuild

pyinstaller --onefile -y install-gpsio.py
/bin/rm -rf pkgbuild_root
/bin/rm -rf pkgbuild_scripts
/bin/mkdir pkgbuild_root
/bin/mkdir pkgbuild_root/host
/bin/mkdir pkgbuild_scripts
/bin/cp -Rf ../host/mac/dist/gpsio-host/* pkgbuild_root/host
/bin/cp -Rf ../host/mac/dist/gpsio-host/*.* pkgbuild_root/host
/bin/cp -f dist/install-gpsio pkgbuild_scripts/postinstall
/bin/cp -f prerequisites/common/*.* pkgbuild_root
/bin/cp -f prerequisites/mac/*.* pkgbuild_root
pkgbuild --identifier gpsio.pkg --root pkgbuild_root --scripts pkgbuild_scripts --install-location /Library/gpsio-install-tmp gpsio.pkg
/bin/rm -rf dist # generated by pyinstaller
/bin/rm -rf build # generated by pyinstaller
# /bin/rm -rf pkgbuild_root
# /bin/rm -rf pkgbuild_scripts
